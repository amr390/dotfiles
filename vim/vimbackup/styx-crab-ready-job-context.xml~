<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/batch"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:beans="http://www.springframework.org/schema/beans"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch-2.1.xsd">

	<job id="styx-crab-ready-job">
		<step id="scr-download-crab-files" next="scr-decompress-crab-files">
			<tasklet ref="scr-downloadCrabFileTasklet" />
			<listeners>
				<listener ref="scr-FeedbackStepListener" />
			</listeners>
		</step>
		<step id="scr-decompress-crab-files">
			<tasklet ref="scr-decompressCrabFileTasklet" />
			<listeners>
				<listener ref="scr-FeedbackStepListener" />
			</listeners>
		</step>

	<!--
		<step id="scr-process-crab-files">
			<tasklet ref="scr-processCrabFileTasklet"/>
		</step>
    -->
        <listeners>
            <listener>
                <beans:bean factory-bean="jobExecutionListenerFactory"
                    factory-method="createResultFeedbackListener" />
            </listener>
        </listeners>

	</job>

	<beans:bean id="scr-JobDefinition" factory-bean="jobDefinitionFactory" factory-method="createJobDefinition">
		<beans:constructor-arg value="styx-crab-ready-job" />
		<beans:property name="jobParameterDefinitions">
			<beans:list>
				<beans:bean factory-bean="jobDefinitionFactory" factory-method="createJobParameterDefinitionForPartitionSize" />
				<beans:bean factory-bean="jobDefinitionFactory" factory-method="createJobParameterDefinitionForChunkSize" />
				<beans:bean factory-bean="jobDefinitionFactory" factory-method="createJobParameterDefinitionForJobFolder" />

				<beans:bean factory-bean="jobDefinitionFactory" factory-method="createJobParameterDefinition">
					<beans:constructor-arg value="#{T(be.cipal.styx.batch.crabready.batch.JobConstants).DOWNLOAD_URL_VAR}" />
					<beans:constructor-arg value="#{T(be.cipal.csf.common.batch.api.JobParameterType).STRING}" />
					<beans:constructor-arg value="false" />
				</beans:bean>

				<beans:bean factory-bean="jobDefinitionFactory" factory-method="createJobParameterDefinition">
					<beans:constructor-arg value="#{T(be.cipal.styx.batch.crabready.batch.JobConstants).INPUT_PATH_VAR}" />
					<beans:constructor-arg value="#{T(be.cipal.csf.common.batch.api.JobParameterType).STRING}" />
					<beans:constructor-arg value="false" />
				</beans:bean>

				<beans:bean factory-bean="jobDefinitionFactory" factory-method="createJobParameterDefinition">
					<beans:constructor-arg value="#{T(be.cipal.styx.batch.crabready.batch.JobConstants).OUTPUT_PATH_VAR}" />
					<beans:constructor-arg value="#{T(be.cipal.csf.common.batch.api.JobParameterType).STRING}" />
					<beans:constructor-arg value="false" />
				</beans:bean>
				<beans:bean factory-bean="jobDefinitionFactory" factory-method="createJobParameterDefinition">
					<beans:constructor-arg value="#{T(be.cipal.styx.batch.crabready.batch.JobConstants).OUTPUT_FILENAME_VAR}" />
					<beans:constructor-arg value="#{T(be.cipal.csf.common.batch.api.JobParameterType).STRING}" />
					<beans:constructor-arg value="false" />
				</beans:bean>

			</beans:list>
		</beans:property>
	</beans:bean>

	<beans:bean id="scr-JobParameterWrapper" factory-bean="jobParameterFactory" factory-method="createJobParameterWrapper" scope="step">
		<beans:constructor-arg
			value="#{jobExplorer.getJobExecution(stepExecution.getJobExecutionId()).getJobInstance().getJobParameters()}" />
	</beans:bean>

	<beans:bean id="scr-JobDataLogger" factory-bean="jobDataLoggerFactory" factory-method="createFeedbackServiceJobDataLogger" scope="step">
		<beans:constructor-arg value="#{stepExecution.jobExecutionId}" />
		<beans:constructor-arg value="#{stepExecution.id}" />
	</beans:bean>

	<beans:bean id="scr-FeedbackStepListener" factory-bean="stepExecutionListenerFactory"
		factory-method="createResultFeedbackListener" scope="step">
		<beans:constructor-arg ref="scr-JobDataLogger" />
	</beans:bean>


	<beans:bean id="scr-CheckParametersTasklet" factory-bean="taskletFactory" factory-method="createValidateJobParametersTasklet" scope="step">
		<beans:constructor-arg ref="scr-JobDefinition" />
		<beans:constructor-arg ref="scr-JobParameterWrapper" />
	</beans:bean>

	<beans:bean id="scr-downloadCrabFileTasklet" class="be.cipal.styx.batch.crabready.batch.DownloadCrabFileTasklet" scope="step" >
		<beans:constructor-arg ref="scr-JobParameterWrapper" />
	</beans:bean>

	<beans:bean id="scr-decompressCrabFileTasklet" class="be.cipal.styx.batch.crabready.batch.DownloadCrabFileTasklet" scope="step">
		<beans:constructor-arg ref="scr-JobParameterWrapper" />
	</beans:bean>

<!-- 	<beans:bean id="scr-processCrabFileTasklet" class="be.cipal.styx.batch.crabready.batch.DownloadCrabFileTasklet" scope="step">
		<beans:constructor-arg ref="scr-JobParameterWrapper" />
	</beans:bean> -->

</beans:beans>
