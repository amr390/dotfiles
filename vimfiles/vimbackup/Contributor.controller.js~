(function(){
    'use strict';

    angular.module('vatbook.controllers')
    .controller('ContributorController', ['ContributorApi', '$location', '$routeParams', '$scope', function (contributorApi, $location, $routeParams, $scope) {
        $scope.loadcontributors = function(){
            // Edit
            if($routeParams.id != null){
                contributorApi.get($routeParams.id).then(function(data){
                    $scope.contributor = data;
                });
            // New or list
            }else{
                contributorApi.list().then(function(data){
                    $scope.contributors = data;
                });
            }
        }

        $scope.contributor = {
            first_name:"",
            last_name:"",
            email:"",
        }

        $scope.save = function(){
            var promise;
            if ($scope.contributor.id){
                promise = contributorApi.update($scope.contributor);
            }else{
                promise = contributorApi.save($scope.contributor);
            }

            promise.then(function(){
                $location.path("/contributor/list");
            });
        };

        $scope.remove = function(id){
            contributorApi.remove(id).then(function(){
                $scope.loadcontributors();
            });
        }

        $scope.edit = function(id){
            // Request contributor on load
            $location.path("/contributor/edit/"+id);
        };

        // We watch for contributors to refresh list view
        $scope.$watch('contributors');
        $scope.loadcontributors();
    }]);
}());
