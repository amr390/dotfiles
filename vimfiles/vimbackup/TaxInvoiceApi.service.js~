(function(){
    'use strict';

    angular.module('vatbook.services')
    .factory('TaxInvoiceApi', ['$resource', function($resource){
        var Endpoint = $resource('/vatbook/invoice/tax/:id', {id: '@_id'},{
            update:{
                method: 'PUT'
            }
        }),
        repository = {};

        repository.list = function(){
            return Endpoint.query().$promise;
        };

        repository.save = function(client){
            var client = new Endpoint(client);
            return client.$save();
        };

        repository.update = function(data){
            var item = Endpoint.get({id:data.id});
            item.concept = data.concept;
            item.contributor = data.contributor;
            item.date_issue = data.date_issue;
            item.date_listing = data.date_listing;
            item.base_cost = data.base_cost;
            item.effective_cost = data.effective_cost;
            item.percent_applied = data.percent_applied;
            item.vat_cost = data.vat_cost;

            // TODO: add jquery extends instead of manual
            return item.$update({id:data.id});
        };

        repository.get = function(id){
            return Endpoint.get({id:id}).$promise;
        };

        repository.remove = function(id){
            return Endpoint.delete({id:id}).$promise;
        };

        return repository;
    }]);
}());
