#!/bin/bash

if [ "`id -gn`" == "`id -un`" -a `id -u` -gt 99 ]; then
    umask 002
else
    umask 022
fi

if [ -f /etc/bash_completion ]; then
    . /etc/bash_completion
    . ~/dotfiles/bash/kubectl_completion
fi

# ---------------------------------------------------------
# -- 1.2) Set up bash prompt and ~/.bash_eternal_history --
# ---------------------------------------------------------
if [ "$PS1" ]; then

    PROMPT_COMMAND="${PROMPT_COMMAND:+$PROMPT_COMMAND ; }"'echo -e $$\\t$USER\\t$HOSTNAME\\tscreen $WINDOW\\t`date +%D%t%T%t%Y%t%s`\\t$PWD"$(history 1)" >> ~/.bash_eternal_history'

    # Turn on checkwinsize
    shopt -s checkwinsize

    if [ "x$SHLVL" != "x1" ]; then # We're not a login shell
        for i in /etc/profile.d/*.sh; do
        if [ -r "$i" ]; then
            . $i
        fi
    done
    fi

    if [ -f /home/amr/dotfiles/bash/prompts ]; then
        . /home/amr/dotfiles/bash/prompts
        export PS1=$LIGHT_PROMPT
    fi
fi

# Append to history
# See: http://www.tldp.org/HOWTO/Bash-Prompt-HOWTO/x329.html
shopt -s histappend


# 2.5) sort options
# Ensures cross-platform sorting behavior of GNU sort.
# http://www.gnu.org/software/coreutils/faq/coreutils-faq.html#Sort-does-not-sort-in-normal-order_0021
#unset LANG
#export LC_ALL=POSIX

# 2.6) Install rlwrap if not present
# http://stackoverflow.com/a/677212
 #command -v rlwrap >/dev/null 2>&1 || { echo >&2 "Install rlwrap to use node: sudo apt-get install -y rlwrap";}

# uncomment for a colored prompt, if the terminal has the capability; turned
# off by default to not distract the user: the focus in a terminal window
# should be on the output of commands, not on the prompt
force_color_prompt=yes

# Git branch setup 
source ~/.git-completion.bash
source ~/.git-prompt.sh

# eb autocompletion
if [ -f ~/.local/bin/eb_completion.bash ] ; 
then
    source ~/.local/bin/eb_completion.bash
fi

# host aliases
if [ -f ./host.aliases ] ; 
then
    echo "generating host aliases"
    export HOSTALIASES=./host.aliases
fi

if [ -f private-django-auth-config ] ;
then 
    echo "loading django-auth-config"
    source private-django-auth-config
fi
