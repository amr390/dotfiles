#!/bin/bash

if [ "`id -gn`" == "`id -un`" -a `id -u` -gt 99 ]; then
    umask 002
else
    umask 022
fi

if [ -f /etc/bash_completion ]; then
    . /etc/bash_completion
fi

# ---------------------------------------------------------
# -- 1.2) Set up bash prompt and ~/.bash_eternal_history --
# ---------------------------------------------------------
if [ "$PS1" ]; then

    PROMPT_COMMAND="${PROMPT_COMMAND:+$PROMPT_COMMAND ; }"'echo -e $$\\t$USER\\t$HOSTNAME\\tscreen $WINDOW\\t`date +%D%t%T%t%Y%t%s`\\t$PWD"$(history 1)" >> ~/.bash_eternal_history'

    # Turn on checkwinsize
    shopt -s checkwinsize

    if [ "x$SHLVL" != "x1" ]; then # We're not a login shell
        for i in /etc/profile.d/*.sh; do
        if [ -r "$i" ]; then
            . $i
        fi
    done
    fi

    MAGENTA="\[\033[0;35m\]"
    YELLOW="\[\033[0;33m\]"
    BLUE="\[\033[34m\]"
    LIGHT_GRAY="\[\033[0;37m\]"
    DARK_GRAY="\[\033[0;30m\]"
    CYAN="\[\033[0;36m\]"
    GREEN="\[\033[0;32m\]"
    GIT_PS1_SHOWDIRTYSTATE=true
    export LS_OPTIONS='--color=auto'
    export CLICOLOR='Yes'
    export LSCOLORS=gxfxbEaEBxxEhEhBaDaCaD

    export PS1=$LIGHT_GRAY'$(
        if [[ $(__git_ps1) =~ \*\)$ ]]
        # a file has been modified but not added
        then echo "'$YELLOW'"$(__git_ps1 "(%s)")
        elif [[ $(__git_ps1) =~ \+\)$ ]]
        # a file has been added, but not commited
        then echo "'$MAGENTA'"$(__git_ps1 "(%s)")
        # the state is clean, changes are commited
        else echo "'$CYAN'"$(__git_ps1 "(%s)")
        fi)'$BLUE"\W"$LIGHT_GRAY": "

    #export PS1=$BLUE'$(
        #if [[ $(__git_ps1) =~ \*\)$ ]]
        ## a file has been modified but not added
        #then echo "'$YELLOW'"$(__git_ps1 " (%s)")
        #elif [[ $(__git_ps1) =~ \+\)$ ]]
        ## a file has been added, but not commited
        #then echo "'$MAGENTA'"$(__git_ps1 " (%s)")
        ## the state is clean, changes are commited
        #else echo "'$CYAN'"$(__git_ps1 " (%s)")
        #fi)'$BLUE" \W"$DARK_GRAY": "

    # export PS1=$DARK_GRAY"\u@\h"'$(
        #if [[ $(__git_ps1) =~ \*\)$ ]]
        ## a file has been modified but not added
        #then echo "'$YELLOW'"$(__git_ps1 " (%s)")
        #elif [[ $(__git_ps1) =~ \+\)$ ]]
        ## a file has been added, but not commited
        #then echo "'$MAGENTA'"$(__git_ps1 " (%s)")
        ## the state is clean, changes are commited
        #else echo "'$CYAN'"$(__git_ps1 " (%s)")
        #fi)'$BLUE" \W"$DARK_GRAY": "
fi

# Append to history
# See: http://www.tldp.org/HOWTO/Bash-Prompt-HOWTO/x329.html
shopt -s histappend


# 2.5) sort options
# Ensures cross-platform sorting behavior of GNU sort.
# http://www.gnu.org/software/coreutils/faq/coreutils-faq.html#Sort-does-not-sort-in-normal-order_0021
#unset LANG
#export LC_ALL=POSIX

# 2.6) Install rlwrap if not present
# http://stackoverflow.com/a/677212
 #command -v rlwrap >/dev/null 2>&1 || { echo >&2 "Install rlwrap to use node: sudo apt-get install -y rlwrap";}

# uncomment for a colored prompt, if the terminal has the capability; turned
# off by default to not distract the user: the focus in a terminal window
# should be on the output of commands, not on the prompt
force_color_prompt=yes

# Git branch setup 
source ~/.git-completion.bash
source ~/.git-prompt.sh

# eb autocompletion
if [ -f ~/.local/bin/eb_completion.bash ] ; 
then
    source ~/.local/bin/eb_completion.bash
fi
